---
layout: post
title: Creating a baby journal with TiddlyWiki 5
date: '2014-02-20T13:01:00.000+01:00'
author: A Penguin in Redmond
tags:
- JavaScript
- Programming
- HTML
- Parenting
- TiddlyWiki
modified_time: '2020-02-19T10:59:04.382+01:00'
thumbnail: /images/journal3.png
permalink: /2014/02/creating-baby-journal-with-tiddlywiki-5.html
---

<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script><p dir="ltr">Keeping a journal about your baby is fun. It allows you to keep track of those events in your baby's life and development that are most important to you, and to tell them in your own words. Sometimes it's not just fun but rather a necessity to keep a baby journal, like when the doctor wants you to keep a record of how many nappies the little one uses daily and what's in them. </p><p>There are plenty of online services that can help to keep such a diary, but you need to have an internet connection to access them, and you have to trust them to keep your data safe. </p><p>This blog post descibes how to keep a journal that will also be available to you when you're offline. It will be just one file that you can store anywhere and view or edit with any modern web browser. Journal entries can contain rich text and images, and automatically show the entry's date and your baby's age at that date:  </p><p></p><div class="separator" style="clear: both; text-align: center;"><img border="0" src="/images/journal3.png"></div><p></p>
<!--end_excerpt-->
<h2>TiddlyWiki</h2><p dir="ltr">The journal will be based on <a href="http://www.tiddlywiki.com">TiddlyWiki 5</a>, created by Jeremy Ruston. Now, this is a blog mainly about developing software, and here's where things start to get all technical and fun. However, if you're a non-technical parent who just came here looking for a simple baby journal application, you may (almost) stop reading, download the finished version of the file we're about to create over <a href="https://github.com/redmond-penguin/baby-journal-tiddly/archive/main.zip" target="_blank">here</a>, unzip it, open <b>BabyJournal.html</b> in your favourite browser, enter your baby's details in the <b>Personal data</b> section and start creating journal entries. I think it all works pretty straightforward, but do remember to click the big Save button <svg viewBox="4 512 64 60" width="22pt" height="21pt"><path d="M 13.5 537.75 L 11.5 537.75 C 11.5 537.75 11.5 537.75 11.5 537.75 C 7.6340064 537.75 4.4999994 540.884 4.5 544.75 L 4.5 564.5 L 4.5 564.5 C 4.5 564.5 4.5 564.5 4.5 564.5 L 4.5 564.5 C 4.5000006 568.366 7.634007 571.5 11.5 571.5 L 60.5 571.5 C 64.365993 571.5 67.5 568.366 67.5 564.5 L 67.5 544.75 C 67.5 540.884 64.365993 537.75 60.5 537.75 L 58.5 537.75 L 49.5 546.75 L 50 546.75 C 52.20914 546.75 54 548.54086 54 550.75 L 54 556.25 C 54 558.45914 52.20914 560.25 50 560.25 L 36 560.25 L 22 560.25 C 19.790861 560.25 18 558.45914 18 556.25 L 18 556.25 C 18 556.25 18 556.25 18 556.25 L 18 550.75 C 18 548.54086 19.790861 546.75 22 546.75 C 22 546.75 22 546.75 22 546.75 L 22.5 546.75 Z"></path><path d="M 16.37132 533.87132 L 33.87868 551.37868 C 35.050253 552.55025 36.949747 552.55025 38.12132 551.37868 L 55.62868 533.87132 C 56.800252 532.69975 56.800252 530.80025 55.62868 529.62868 C 55.06607 529.06607 54.30301 528.75 53.50736 528.75 L 48 528.75 C 46.343146 528.75 45 527.40685 45 525.75 L 45 516 C 45 514.34315 43.656854 513 42 513 L 30 513 C 28.343146 513 27 514.34315 27 516 L 27 525.75 C 27 527.40685 25.656854 528.75 24 528.75 L 18.492641 528.75 C 16.835786 528.75 15.492641 530.09315 15.492641 531.75 C 15.492641 532.54565 15.808711 533.3087 16.37132 533.87132 Z"></path></svg> before exiting your browser. Check the <a href="http://www.tiddlywiki.com">TiddlyWiki website</a> for any additional help.</p><p>Still reading? Excellent. So I mentioned TiddlyWiki. It's an interesting piece of software that implements a wiki type of application in a single html file which contains all the html, JavaScript and css needed to run the application as well as the data that the user puts into the wiki. It's highly customizable and has many different uses. For our baby journalling purpose, we will create a faily standard TiddlyWiki file with one customization: the entry's date and the baby's age will appear at the top of each journal entry.</p><h2>Getting started</h2><p>To start creating the journal, you need an empty TiddlyWiki. Download it at <a href="http://www.tiddlywiki.com">http://www.tiddlywiki.com</a> by clicking the large green button that says <b>Download Empty</b>. Save the file wherever you like, and then open it with your browser. Let's start by giving your journal a title. Click the Control Panel button <svg viewBox="434 218 68 68" width="22pt" height="22pt"><path d="M 478.39696 232.53705 L 478.39696 232.53705 C 477.11453 231.85132 475.77877 231.30146 474.4106 230.88735 L 474.4106 218.24993 L 461.58944 218.24993 L 461.58944 230.88735 C 460.22126 231.30146 458.8855 231.85132 457.60308 232.53705 L 448.66825 223.60214 L 439.6022 232.66814 L 448.53716 241.60304 C 447.8515 242.88541 447.30158 244.22116 446.88747 245.58935 L 434.25 245.58935 L 434.25 258.41052 L 446.88747 258.41052 C 447.30158 259.7787 447.8515 261.11446 448.53716 262.39689 L 439.6022 271.33173 L 448.66825 280.39779 L 457.60308 271.46281 C 458.8855 272.14862 460.22126 272.69847 461.58944 273.11251 L 461.58944 285.74986 L 474.4106 285.74986 L 474.4106 273.11251 C 475.77877 272.69847 477.11453 272.14862 478.39696 271.46281 L 487.3318 280.39779 L 496.3977 271.33173 L 487.46287 262.39689 C 488.14854 261.11446 488.6984 259.7787 489.11257 258.41052 L 501.7499 258.41052 L 501.7499 245.58935 L 489.11257 245.58935 C 488.6984 244.22116 488.14854 242.88541 487.46287 241.60304 L 496.3977 232.66814 L 487.3318 223.60214 Z M 475.3328 244.66714 C 479.38253 248.71698 479.38253 255.2829 475.3328 259.33273 C 471.28297 263.3826 464.71706 263.3826 460.66723 259.33273 C 456.61737 255.2829 456.61737 248.71698 460.66723 244.66714 C 464.71706 240.61734 471.28297 240.61734 475.3328 244.66714"></path></svg> and enter a title at <b>Title of this TiddlyWiki</b>, and maybe a subtitle at <b>Subtitle</b>. Then click the Save button (see above). Your browser will ask you for a location to save the file, which can be the same location where you originally saved the file. </p><p>There, that was the basic process of editing the TiddlyWiki file: open it in the browser, make some modifications and then click Save. Of course, the saving process is a bit awkward with that file requestor. For Firefox, it can be made a one-click affair by installing an extension. You could also use TiddlyDesktop which is a standalone application providing a browser and easy management of TiddlyWiki files. See the TiddlyWiki website for more information. </p><h2>The first tiddler</h2><p>In TiddlyWiki, information is stored in <i>tiddlers</i>. They are comparable to pages or articles in other wikis. Let's create a tiddler that contains some general information about your baby. Click on the big + button and enter as title for the new tidder: <b>Personal data</b>. In the text area below the title you can write whatever you like about the baby, but there are 2 special bits of information that we want to use in other parts of the journal too: the baby's first name and birth date. To easily access these from elsewhere, we put them in <i>fields</i>. At <b>Add a new field</b>, enter </p><pre>firstname</pre> and click the <b>Add</b> button. Now you can enter a value for the field, so enter your baby's first name. Repeat the process for the new field <pre>birthdate</pre> and enter the baby's birth date in the notation yyyymmdd (for example if the baby was born on 31 October 2013, enter&nbsp;<span class="Apple-style-span" style="font-family: monospace; white-space: pre; ">20131031). </span>Finish the creation of the new tiddler by clicking âœ“. This stores the new tiddler in memory, but not yet on disk. To also save it on disk, click the large Save button again (see above). <p>Now you can use the values of these fields wherever you want with syntax: </p><pre class="prettyprint">{{ "{{" }}Personal data!!firstname}}</pre>and <pre class="prettyprint">{{ "{{" }}Personal data!!birthdate}}</pre>For example, as title (in Control Panel, see above) you could set: <pre class="prettyprint">{{ "{{" }}Personal data!!firstname}}'s journal</pre>Then your baby's name would appear in the title. You'll notice that after saving, the <b>Personal data</b> tiddler doesn't show these 2 fields and their values anymore; they're only visible in edit mode, not in view mode. To also see them in view mode, the text of the tiddler should explicitly reference them. Click on the tiddler's pen icon to modify it and write the following wikitext into the tiddler's text area, which will show the field names and values in a table: <pre class="prettyprint"><br />|Birth date (yyyymmdd): |{{ "{{" }}!!birthdate}}|<br />|First name: |{{ "{{" }}!!firstname}}|<br /></pre>Here the tiddler's name can be omitted before the !!, because it's the current tiddler itself. By the way, the tiddler's text is actually also a field of the tiddler. It's a standard field that any tiddler has, whereas the 2 new fields you just added are <i>custom</i> fields that only the <b>Personal data</b> tiddler has. <h2>Importing a tiddler from another TiddlyWiki</h2>As said in the introduction, we want to show the date of a journal entry in its header. Unfortunately TiddlyWiki has no built-in support for showing dates. It does support macros to add custom functionality though, so let's make a JavaScript macro to do it. Actually someone already made such a macro, so you just need to import it into your journal. To do this, open a new browser window and in it, go to Stephan Hradek's site <a href="http://tiddlystuff.tiddlyspot.com/">http://tiddlystuff.tiddlyspot.com</a> and click on the link to the tiddler "dateTimeMacro". At the bottom of this tiddler, there is a link called <b>$:/macros/skeeve/dateTime.js</b>. Drag and drop this link into your journal (from one window to the other). Now you have a macro for showing the date of a tiddler. Have a look at it to get a general idea about what JavaScript macros look like in TiddlyWiki. (If you can't see it anymore: it should be in the More -&gt; System section of your Control Panel.) <h2>Creating your own JavaScript macro</h2>Before we go on using the dateTimeMacro to create the journal entry header, we need one more macro there: to calculate and show the age of your baby. This macro you will have to make by yourself. Create a new tiddler and call it <b>$:/macros/penguin/age.js</b>. Set its Type field to "application/javascript". Add a field called "module-type" and set it to "macro". Then, in the tiddler text paste the following JavaScript code that implements the macro: <pre class="prettyprint"><br />(function(){<br /><br />"use strict";<br /><br />exports.name = "age";<br /><br />exports.params = [ { name: "birthDate" }, { name: "currentDate" } ];<br /><br />exports.run = function(birthDate, currentDate) {<br />  var getNormalizedDate = function (date, referenceDate) {<br />    var numberOfDaysInMonth = (new Date(date.getFullYear(), date.getMonth()+1, 0)).getDate();<br />    if (numberOfDaysInMonth < referenceDate.getDate()) {<br />      return numberOfDaysInMonth;<br />    }<br />    else {<br />      return referenceDate.getDate();<br />    }<br />  }<br />  var getAgeString = function (birthDate, currentDate) {<br />    var tmpBirthDate = new Date(birthDate);<br />    var tmpCurrentDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());<br />    if (tmpCurrentDate < tmpBirthDate) return "not yet born";<br />    tmpCurrentDate.setHours(12);<br />    var ageDays = 0;<br />    while (tmpCurrentDate.getDate() != getNormalizedDate(tmpCurrentDate, tmpBirthDate)) {<br />      ageDays++;<br />      tmpCurrentDate.setDate(tmpCurrentDate.getDate() - 1);<br />    }<br />    tmpCurrentDate.setDate(1);<br />    tmpBirthDate.setDate(1);<br />    var ageMonths = 0;<br />    while (tmpCurrentDate.getMonth() != tmpBirthDate.getMonth()) {<br />      ageMonths++;<br />      tmpCurrentDate.setMonth(tmpCurrentDate.getMonth() - 1);<br />    }<br />    var ageYears=0;<br />    while (tmpCurrentDate.getFullYear() != tmpBirthDate.getFullYear()) {<br />      ageYears++;<br />      tmpCurrentDate.setFullYear(tmpCurrentDate.getFullYear() - 1);<br />    }<br />    return ageYears + ' year' + (ageYears == 1 ? '' : 's') + ', ' + ageMonths + ' month' + (ageMonths == 1 ? '' : 's') + ' and ' + ageDays + ' day' + (ageDays == 1 ? '' : 's');<br />  };<br /><br />  if (typeof(currentDate) == "undefined" || currentDate == "" || isNaN(currentDate)) {<br />    currentDate = new Date();<br />  }<br />  else<br />  {<br />    currentDate = new Date(currentDate.substring(0,4), currentDate.substring(4,6) - 1, currentDate.substring(6, 8));<br />  }<br />  if (typeof(birthDate) == "undefined" || birthDate == "" || isNaN(birthDate)) {<br />    birthDate = new Date();<br />  }<br />  else<br />  { <br />    birthDate = new Date(birthDate.substring(0,4), birthDate.substring(4,6) - 1, birthDate.substring(6, 8));<br />  }<br />  return getAgeString(birthDate, currentDate);<br />};<br />})();<br /></pre> For any JavaScript macro in TiddlyWiki, the <b>exports</b> object needs 3 attributes: <b>name</b> for the macro name (age), <b>params</b> for its parameters (birthDate and currentDate) and <b>run</b> for the function to run when it's invoked.  <h2>Defining the header for journal entries</h2>Now you can create the header that will appear at the top of all journal entries. Create a new tiddler called <b>JournalEntryHeader</b> and paste the following text in it: <pre class="prettyprint"><br />&lt;$list filter="[is[current]tag[JournalEntry]]"&gt;<br />//&lt;$macrocall $name="dateTime" ts={{ "{{" }}!!created}} format="DDD DD MMM YYYY"/&gt;//&lt;br&gt;<br />{{ "{{" }}Personal data!!firstname}} is &lt;$macrocall $name="age" birthDate={{ "{{" }}Personal data!!birthdate}} currentDate={{ "{{" }}!!created}} /&gt; old.&lt;hr&gt;&lt;/$list&gt;<br /></pre>This looks rather complicated, so let's see what's happening there.  <p>The whole header is enclosed in a $list construct. This list has 0 or 1 elements, depending on the tiddler in which it appears. It's a rather awkward construction, but it basically says: show information about the current tiddler, but only if this tiddler has tag <b>JournalEntry</b>. This way, we can include the header in all tiddlers (which is easiest to do, see below), while it only shows text for some tiddlers. </p><p>Inside the list, our 2 macros are used. First there's the dateTime macro which will show the tiddler's creation date (the field <b>created</b>) in the format "name_of_weekday monthday name_of_month year". It's enclosed by // to make it appear in italics. Then there's a line that shows the baby's age. It references the baby's name set in <b>Personal data</b> and then calls the age macro which computes the age at the tiddler's creation date, given the birth date defined in <b>Personal data</b>.  </p><p>To include the header in all tiddlers, you just need to add a tag <b>$:/tags/ViewTemplate</b> to the JournalEntryHeader tiddler. However, that doesn't include it at the <i>top</i> of the tiddler, but at the bottom. It's kind of expected for a header to appear at the top, so let's make sure that happens. For this, open the tiddler <b>$:/tags/ViewTemplate</b> (to be found in Control Panel -&gt; More -&gt; Shadows) and edit it. In its field "list", insert <b>JournalEntryHeader</b> before <b>$:/core/ui/ViewTemplate/body</b>. Now the header will appear before the tiddler's body. </p><p>Now you can test the macros. It's important to note that a new macro doesn't work until you save the tiddler and then refresh the browser, so first do that. Then create a new tiddler and add a tag <b>JournalEntry</b> to it. Type some text and a title, and then save the tiddler. The new tiddler should now show the header with the date (today) and the baby's age. If not, you may have made a typo in one of the macros or elsewhere. Maybe you noticed that the header was not shown while you were editing the tiddler. To also show the header in edit mode, you need to do with <b>$:/tags/EditTemplate</b> what you did with <b>$:/tags/ViewTemplate</b>.  </p><h2>Putting things together: the main page</h2>Now it's time to bring everything together and finish the journal. Let's create a tiddler entitled <b>Main page</b> and make sure it's always visible when we start the journal. To ensure that, go to Control Panel and put <b>[[Main page]]</b> in the Default Tiddlers. <h4>The main page's header</h4><p>At the top of the main page, let's put information similar to what's in the headers of journal entries, but now related to the current date. So when you open the journal, you'll always see the current date and your baby's current age. This is accomplished by calling the macros without the currentDate argument (which makes it default to <i>now</i>). Put the following at the top of your <b>Main page</b> tiddler: </p><pre class="prettyprint"><br />//&lt;&lt;dateTime format: "DDD DD MMM YYYY"&gt;&gt;//&lt;br&gt;<br />Today {{ "{{" }}Personal data!!firstname}} is &lt;$macrocall $name="age" birthDate={{ "{{" }}Personal data!!birthdate}} /&gt; old.&lt;hr&gt;<br /></pre>Note the much shorter syntax for the dateTime macrocall: &lt;&lt;.&gt;&gt; instead of &lt;$macrocall&gt;..&lt;/$macrocall&gt;. This shorter syntax can't always be parsed correctly, which is why elsewhere we use the longer one. <h4>A button to create new journal entries</h4>Creating a new journal entry is still pretty awkward: first you have to click the button to create a new tiddler, then you need to assign a <b>JournalEntry</b> tag to it. Luckily we can do both in one click by adding a custom "Create journal entry" button. This button will create a new tiddler based on a template (a "Skeleton" in TiddlyWiki terminology). In this template, then, you can specify what stuff you want to be in every journal entry. This is at least the tag <b>JournalEntry</b>, and maybe some fields for specific data you want to keep track of, such as weight, height, number of full nappies... So create a new tiddler called <b>JournalEntrySkeleton</b> and add the tag <b>JournalEntry</b> to it plus any other stuff you want to be in each journal entry, and then add the following to the <b>Main page</b> to make the button appear there: <pre class="prettyprint"><br />&lt;$button message="tm-new-tiddler" param="JournalEntrySkeleton"&gt;New journal entry&lt;/$button&gt;<br /></pre><h4>A table of contents</h4>Finally, it might be useful to have a list with links to all journal entries you created, plus a link to the <b>Personal data</b> tiddler. Add the following to the <b>Main page</b> tiddler: <pre class="prettyprint"><br /><br />[[Personal data]]<br />&lt;hr&gt;<br />&lt;h2&gt;Journal entries:&lt;/h2&gt;<br /><br />&lt;$list filter="[tag[JournalEntry]!title[JournalEntrySkeleton]sort[created]]"&gt;&lt;$link to={{ "{{" }}!!title}}&gt;&lt;$view field="title" /&gt; (&lt;$macrocall $name="dateTime" ts={{ "{{" }}!!created}} format="DD MMM YYYY"/&gt;)&lt;br&gt;&lt;/$link&gt;<br /><!--$list--><br /></pre>Here the $list construct is used again, this time to actually produce a list (as opposed to just those 0 or 1 lines in the <b>JournalEntryHeader</b>). It lists all tiddlers with tag <b>journalEntry</b> except the skeleton, sorted by creation date. <p></p><p>And there you have it, a baby journal made with TiddlyWiki 5. I can't guarantee that your baby will be interested to read it when he/she's older, but it will surely be a fun document for you and your partner to look back on those exciting but often exhausting baby years.  </p><h2>Links</h2><ul><li>Empty baby journal, ready to use: <a href="https://github.com/redmond-penguin/baby-journal-tiddly/archive/main.zip">https://github.com/redmond-penguin/baby-journal-tiddly/archive/main.zip</a><li>TiddlyWiki website: <a href="http://www.tiddlywiki.com">http://www.tiddlywiki.com</a></li><li>TiddlyWiki community forum: <a href="http://groups.google.com/group/TiddlyWiki">http://groups.google.com/group/TiddlyWiki</a></li></ul>